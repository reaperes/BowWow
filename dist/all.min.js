function BufferLoader(e,t,o){this.context=e,this.urlList=t,this.onload=o,this.bufferList=[],this.loadCount=0}function Sound(e){function t(e){o.buffers=e}var o=this,n=new BufferLoader(e,["sounds/m4a1.mp3","sounds/m1-garand.mp3"],t);n.load()}BufferLoader.prototype.loadBuffer=function(e,t){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer";var n=this;o.onload=function(){n.context.decodeAudioData(o.response,function(o){return o?(n.bufferList[t]=o,void(++n.loadCount==n.urlList.length&&n.onload(n.bufferList))):void alert("error decoding file data: "+e)})},o.onerror=function(){alert("BufferLoader: XHR error")},o.send()},BufferLoader.prototype.load=function(){for(var e=0;e<this.urlList.length;++e)this.loadBuffer(this.urlList[e],e)};var Data={};Data.load=function(e,t){d3.csv(e).row(function(e){var t=/12-5-\d{2}:\d{1,2}:\d{1,2}:(\d+)/,o=Number(t.exec(e.time)[1]);return 10>=o?{time:e.time,sound:Number(e.sound)}:void 0}).get(function(e,o){t(o)})},Data.findMinMax=function(e){function t(e,t,o,n){var r,u=n-t,i=/12-5-(\d{2}):(\d{1,2}):(\d{1,2}):(\d+)/,a=i.exec(e),d=a[1],s=a[2],f=a[3],c=a[4],m=i.exec(o),l=m[1],v=m[2],h=m[3],p=m[4];return r=36e3*(l-d)+600*(v-s)+10*(h-f)+(p-c),((670+4*u)/3250).toFixed(2)}var o,n,r,u,i=null,a=[];if(void 0!==e&&void 0!==e[0]){for(r=0,u=e[0].sound,o=1,n=e.length;n>o;o++){var d=e[o].sound;d>u?(i===!1&&(r=o-1),i=!0):u>d&&(i&&(t(e[r].time,e[r].sound,e[o-1].time,e[o-1].sound),a.push({startTime:e[r].time,endTime:e[o-1].time,volume:t(e[r].time,e[r].sound,e[o-1].time,e[o-1].sound)})),i=!1),u=d}return i&&(t(e[r].time,e[r].sound,e[o-1].time,e[o-1].sound),a.push({startTime:e[r].time,endTime:e[o-1].time,volume:t(e[r].time,e[r].sound,e[o-1].time,e[o-1].sound)})),a}},Math.average=function(e){var t,o,n=0;for(t=0,o=e.length;o>t;t++)n+=e[t].sound;return parseInt(n/o)},Sound.prototype.shootRound=function(e,t,o,n,r,u){n=void 0!==n?n:.5,"undefined"==typeof r&&(r=0);for(var i=context.currentTime,a=0;t>a;a++){var d=this.makeSource(this.buffers[e],n);d.playbackRate.value=1+Math.random()*u,d.start(i+a*o+Math.random()*r)}},Sound.prototype.makeSource=function(e,t){var o=context.createBufferSource(),n=context.createDynamicsCompressor(),r=context.createGain();return r.gain.value=t,o.buffer=e,o.connect(r),r.connect(n),n.connect(context.destination),o};